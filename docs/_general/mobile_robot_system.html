

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>System Structure &mdash; Weston Robot V0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Operational Safety" href="operational_safety.html" />
    <link rel="prev" title="Introduction: ROS to CAN/Serial interface" href="../_communication/communication.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #323640" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../_communication/communication.html">Introduction: ROS to CAN/Serial interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../_communication/communication.html#can-serial-interface">CAN/Serial Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_communication/communication.html#ros-interface">ROS Interface</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">System Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="#hardware-interface">Hardware Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#can-serial-interface">CAN/Serial interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#overview-of-software-packages">Overview of software Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="#package-naming">Package Naming</a></li>
<li class="toctree-l1"><a class="reference internal" href="operational_safety.html">Operational Safety</a></li>
<li class="toctree-l1"><a class="reference internal" href="robot_maintenance.html">Robot Maintenance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="robot_maintenance.html#battery">Battery</a></li>
<li class="toctree-l2"><a class="reference internal" href="robot_maintenance.html#tire">Tire</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="software_packages.html">Package Naming</a></li>
<li class="toctree-l1"><a class="reference internal" href="software_packages.html#example">Example</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_platforms/wheeled/scout/scout.html">Scout Mobile Robot</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/wheeled/scout/scout.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/wheeled/scout/scout.html#software-developemnt-kits">Software Developemnt Kits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/wheeled/scout/scout.html#id1">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/wheeled/scout/scout.html#get-to-know-the-robot">Get to Know the Robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/wheeled/scout/scout.html#pre-operational-check">Pre-operational Check</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/wheeled/scout/scout.html#power-up-and-manual-control">Power-up and Manual Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/wheeled/scout/scout.html#onboard-control">Onboard Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/wheeled/scout/scout.html#id2">Software Developemnt Kits</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_platforms/wheeled/hunter/hunter.html">Hunter Mobile Robot</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_platforms/tracked/bunker.html">Bunker Mobile Robot</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/tracked/bunker.html#basic-operations">Basic Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/tracked/bunker.html#ros-interface">ROS Interface</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_platforms/legged/a1.html">A1 Robot Dog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/legged/a1.html#basic-operations">Basic Operations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_platforms/legged/aliengo.html">Aliengo Robot Dog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../_platforms/legged/aliengo.html#basic-operations">Basic Operations</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Weston Robot</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>System Structure</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/_general/mobile_robot_system.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD:docs/_sources/_overview/overview.rst.txt
Overview of Robots
==================
=======
Mobile Robot System
===================
This page is meant to give a brief overview of the platforms used in Weston Robot and the packages developed by Weston Robots</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#system-structure" id="id3">System Structure</a></li>
<li><a class="reference internal" href="#hardware-interface" id="id4">Hardware Interface</a><ul>
<li><a class="reference internal" href="#can-serial-interface" id="id5">CAN/Serial interface</a></li>
</ul>
</li>
<li><a class="reference internal" href="#overview-of-software-packages" id="id6">Overview of software Packages</a></li>
<li><a class="reference internal" href="#package-naming" id="id7">Package Naming</a></li>
</ul>
</div>
<div class="section" id="system-structure">
<h1><a class="toc-backref" href="#id3">System Structure</a><a class="headerlink" href="#system-structure" title="Permalink to this headline">Â¶</a></h1>
<p>&gt;&gt;&gt;&gt;&gt;&gt;&gt; refs/remotes/origin/pd_dev:source/_general/mobile_robot_system.rst
In general, most of the robots have an on-board embedded controller that will manage the low level control of individual motors
to achieve a desired control input (velocity and steering angle/angular velocity).</p>
<p>The desired control input can be sent to the embedded controller in 3 main ways:</p>
<ol class="arabic simple">
<li>Remote controller via radio frequency</li>
<li>A physical connection via CAN bus</li>
<li>A physical connection via Serial bus</li>
</ol>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD:docs/_sources/_overview/overview.rst.txt
Furthermore, the embedded controller is also able to communicate the state of the platform, such as measured velocities, temperature, currents etc, to an external computer via the CAN or Serial bus.
=======
Furthermore, the embedded controller is also able to communicate the state of the platform to an external computer via the CAN or Serial bus.
For most platforms, the On-board embedded controller send back messages on state of the platform,
such as measured velocities, temperature, currents etc.</p>
</div>
<div class="section" id="hardware-interface">
<h1><a class="toc-backref" href="#id4">Hardware Interface</a><a class="headerlink" href="#hardware-interface" title="Permalink to this headline">Â¶</a></h1>
<div class="section" id="can-serial-interface">
<h2><a class="toc-backref" href="#id5">CAN/Serial interface</a><a class="headerlink" href="#can-serial-interface" title="Permalink to this headline">Â¶</a></h2>
<p>Information on CAN bus can be found in <a class="reference external" href="https://www.youtube.com/watch?v=FqLDpHsxvf8">https://www.youtube.com/watch?v=FqLDpHsxvf8</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/CAN_bus">https://en.wikipedia.org/wiki/CAN_bus</a>.</p>
<p>Many protocols for communication through the CAN bus is similar for different platforms.
As such, a abstract class <cite>MobileBase</cite> was designed as the super class of the CAN interface class for each robot model.</p>
<p>On the level of <cite>MobileBase</cite> the following is settled:</p>
<ol class="arabic simple">
<li>Setting up CAN connection</li>
<li>Disconnecting CAN connection</li>
<li>Maintaining stream of CAN Frames</li>
</ol>
<div class="section" id="setting-up-can-connection">
<h3>Setting up CAN connection<a class="headerlink" href="#setting-up-can-connection" title="Permalink to this headline">Â¶</a></h3>
<p>During the setting up of CAN connection, the protocol used to read the CAN Frame will be set.
Since each platform will process CAN Frames differently, each platform will write its own ParseCANFrame(can_frame <a href="#id1"><span class="problematic" id="id2">*</span></a>rx_frame) function.
The calling
&gt;&gt;&gt;&gt;&gt;&gt;&gt; refs/remotes/origin/pd_dev:source/_general/mobile_robot_system.rst</p>
</div>
</div>
</div>
<div class="section" id="overview-of-software-packages">
<h1><a class="toc-backref" href="#id6">Overview of software Packages</a><a class="headerlink" href="#overview-of-software-packages" title="Permalink to this headline">Â¶</a></h1>
<p>This segment is an overview of the packages and aims to aid you when navigating through the different packages.</p>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD:docs/_sources/_overview/overview.rst.txt
The software pacakges provided by Weston Robots aim to achieve the following:
1. Handle the low level communication between the computer and the embedded controller in the robots
2. Provide and interface between ROS messages and communicating with the robots
3. Occasionally, support for simulations (espescailly in webots) is provided
=======
Disconnecting CAN connection
<strong>************************</strong>
&gt;&gt;&gt;&gt;&gt;&gt;&gt; refs/remotes/origin/pd_dev:source/_general/mobile_robot_system.rst</p>
</div>
<div class="section" id="package-naming">
<h1><a class="toc-backref" href="#id7">Package Naming</a><a class="headerlink" href="#package-naming" title="Permalink to this headline">Â¶</a></h1>
<ul class="simple">
<li>wrp_sdk: This SDK deals with the low level communication between the computer and the robot platofrm via CAN and Serial bus. Currently, this SDK supports the platforms Hunter,Scout and Tracer.</li>
<li>&lt;platform_name&gt;_base: These SDKs provide the interface between ROS and wrp_sdk. Essentially, these SDKs simplify the creating of a ROS node for the platform that translates ROS messages, such as cmd_vel, into  platform-unique messages to each platform. These SDKs utilise tools from wrp_sdk to convert these platform-unique messaages into CAN or serial Messages. As a user of our SDKs, you will largely only interact with the libraries created in the &lt;platform_name&gt;_base SDKs.</li>
</ul>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD:docs/_sources/_overview/overview.rst.txt
Example
ââ-
To give a clearer overview on the purpose of the package, a sample scenario for using these SDKs is described below:</p>
<ul class="simple">
<li>You are using the scout platform with a LIDAR module attachced to it.</li>
<li>You would like to use the ROS navigation stack to control the scout platform in a mapped region using the inputs from the LIDAR module.</li>
<li>Using the LIDARâs own software package, a LIDAR node in ROS is created the publsihes a /scan data.</li>
<li>Using the Scout_Base SDK, a node is created that subscribes to /cmd_vel topics and publishes /odom topic.</li>
<li>Based on the position which the LIDAR is mounted, a .xacro file for the trasnform between the platform and the LIDAR is created.</li>
</ul>
<p>With this, ROS navigation stack is able to navigate the robot based on the provided map.</p>
<p>This specific example has been implemented and can be found in TODO: link to scout_nav package</p>
<hr class="docutils" />
<p>After connecting the robot and the computer via the CAN bus, an additional device should show up from the commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ifconfig -a
</pre></div>
</div>
<p>The new device should be identified as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">can</span><span class="c1">#: flags=.....</span>
</pre></div>
</div>
<p>whereby # is a number, usually # = 0. For the segments below, it is assumed that the connection occurs at can0.
If this occurs, it indicates that the computer is actually connected to the robot via the CAN bus.
You can attempt to read the data being sent via the CAN bus using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ candump can0
</pre></div>
</div>
<p>If the comuunication is working properly, a stream of hexamdeximal should be flooding the command line. If instead the message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="p">:</span> <span class="n">Network</span> <span class="ow">is</span> <span class="n">down</span>
</pre></div>
</div>
<p>is shown, it indicates that TODO: not sure exactly what is indicates:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo ip link set can0 up type can bitrate 500000
</pre></div>
</div>
<p>could fix this issue
&gt;&gt;&gt;&gt;&gt;&gt;&gt; refs/remotes/origin/pd_dev:source/_general/mobile_robot_system.rst</p>
<p>If the CAN communication between the computer andn the platform is still unable to occur, there might be a hardware fault on the robot platform
affecting the CAN communication. The followign websites provide a simple overview on how you could go about debugging the hardware on the robot platform.</p>
<p><a class="reference external" href="https://www.ti.com/lit/an/slyt529/slyt529.pdf?ts=1600396027624&amp;ref_url=https%253A%252F%252Fwww.google.com%252F">https://www.ti.com/lit/an/slyt529/slyt529.pdf?ts=1600396027624&amp;ref_url=https%253A%252F%252Fwww.google.com%252F</a></p>
<p><a class="reference external" href="https://www.ti.com/lit/an/slyt529/slyt529.pdf?ts=1600396027624&amp;ref_url=https%253A%252F%252Fwww.google.com%252F">https://www.ti.com/lit/an/slyt529/slyt529.pdf?ts=1600396027624&amp;ref_url=https%253A%252F%252Fwww.google.com%252F</a></p>
<p><a class="reference external" href="https://support.enovationcontrols.com/hc/en-us/articles/360038856494-CAN-BUS-Troubleshooting-Guide-with-Video">https://support.enovationcontrols.com/hc/en-us/articles/360038856494-CAN-BUS-Troubleshooting-Guide-with-Video</a>-</p>
<p>A simple set of instructionss is given below. These instructions assume basic knnowledge on electrical engineering ad circuits. Furthermore, it is assumed that you have read through the links given Above</p>
<p>1. The robot platforms Scout and Hunter do not have termination resistors between the CAN HI and LO terminals. As such:
a. If would discnnect all peripherals from the robot, and measure the resistance betwweenn CAN HI and LO terminals, a reading of about 50 M ohms or even nopenn circuit is expected.
b. The computer connected to the platform should contain a terminationn resistor of 120 ohms. (If the board provided by weston robots is used, a jumper can be used to attach/dettacch the 120 ohm resistor.</p>
<p>2. With the platform switched off, test the connectivity between corresponding pins of the CAN interface. i.e. Test that CAN HI on all CAN interfaces are connected to each other.
If the different ports are not connected, there is likely ann internal wiring issue with the platform</p>
<p>3. With all peripherals plugged in, and
ROS Interface
ââââ-</p>
<p>The libraries / packages is designed to bridge the communication between the a embedded controller on the mobile platforms
and a higher level ROS environnement on a computer.</p>
<p>In summary, the packages written here converts ROS messages to CAN frames / Serial outputs and back.</p>
<p>The conversion from ROS message to CAN frame occurs in two main steps as shown in the flow chart.</p>
<a class="reference internal image-reference" href="_general/figures/communication_overview.png"><img alt="_general/figures/communication_overview.png" class="align-center" src="_general/figures/communication_overview.png" style="width: 400px;" /></a>
<p>Moving down the flow chart:</p>
<ol class="arabic simple">
<li>The ROS interface will create a node that listens for ROS messages of a specified ROS topic.</li>
<li>The information in the ROS message will be translated into a platform-unique C++ data structure known as a Platform Command.</li>
<li>The Basic Operation package contains the subroutines required to translate these platform into CAN frames.</li>
<li>Furthermore, the package handles the communication of the CAN frame through the CAN bus.</li>
</ol>
<p>Moving up the flow chart:
1. The Basic Operations Interface will also contain the subroutines required to read the CAN frames and translate them
into platform-unique Platform Messages.</p>
<ol class="arabic simple" start="2">
<li>These messages can then be translated into ROS messages by the ROS interface.</li>
<li>The ROS interface will also handle publishing of these messages to the appropriate ROS topic.</li>
</ol>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="operational_safety.html" class="btn btn-neutral float-right" title="Operational Safety" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../_communication/communication.html" class="btn btn-neutral float-left" title="Introduction: ROS to CAN/Serial interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Weston Robot Pte Ltd

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>